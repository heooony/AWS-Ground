![Header (4)](https://user-images.githubusercontent.com/68142821/183649954-85df161d-7da4-4186-ad0e-9c5afe302cae.png)

# AWS Key Management Service (AWS KMS)

<img width="100" alt="image" src="https://user-images.githubusercontent.com/68142821/183649973-74b9e2e1-2f7e-499c-aadf-a300f8fa8a56.png">

## 1. KMS의 사용

"당신의 데이터를 안전하게 지키기 위한 서비스"

"권한 키를 제작하여 암호화, 복호화하는 작업을 감사할 수 있도록 하는 서비스"

> 최근 업데이트 : 2022.08.09

> Tip :
> 
> AWS KMS는 CMK(Customer Master Key)라는 용어가 KMS key으로 바뀐 것입니다. 개념은 바뀌지 않았습니다.

> Tip :
> 
> AWS KMS는 무료가 아닙니다! 프리 티어 범위를 초과하는 KMS에 대해서는 지정된 요청 건수당 요금이 부과됩니다. 예를 들어 Amazon S3를 위한 KMS를 제작한다고 했을 때 1개의 KMS 키는 1.00USD 이며, 10,000건의 암호와 요청당 대략 0.03USD가 부과됩니다.

KMS keys는 AWS KMS의 기본 리소스입니다. KMS키를 사용하면 **데이터를 암호화 하거나 해독, 다시 암호화** 할 수 있습니다. 또한 외부에서 사용할 수 있는 데이터 키를 생성할 수 있습니다.

예를 들어, RDS 데이터베이스 서비스를 통해서 데이터를 저장한다고 했을 때, 해당하는 데이터를 안전하게 지키기 위해 **기본 키**로 지급이 되는 키를 사용하지 않고 직접 만들어서 사용한다는 의미입니다.

KMS의 종류에는 3가지가 있습니다.
- AWS 관리형 키
- 고객 관리형 키
- 사용자 지정 키 스토어

## 1.1. AWS 관리형 키
> Tip :
>
> AWS KMS는 AWS 관리형 키에 대한 교체 일정을 3년에서 매년으로 변경했습니다. 즉, 새 AWS 관리형 키는 생성된 후 1년이 지나면 자동으로 교체되고, 그 후에도 매년 자동으로 교체됩니다.

AWS에서 직접적으로 제공하는 서비스를 사용할 때 쓰게 되는 키입니다. 우리가 관리하는 것이 아닌 AWS에서 직접적으로 관리하며 그에 따라 KMS 키를 관리하거나 교체 및 키 정책을 변경할 수 없습니다. 

<img width="1330" alt="스크린샷 2022-08-09 오후 11 47 08" src="https://user-images.githubusercontent.com/68142821/183679470-11908b79-108b-4fc0-a436-d67c147fd991.png">

관리형 키는 다음과 같이 이용하고 있는 서비스에 대해 키를 나타냅니다. 저는 RDS에서 사용한 이력이 있어 키로 남아있습니다. S3 bucket을 하나 제작한다고 했을 때 암호화 관련 설정이 존재할까요?

<img width="800" alt="스크린샷 2022-08-09 오후 11 50 13" src="https://user-images.githubusercontent.com/68142821/183680766-4e50e710-bf05-4c43-a729-5786b491e94c.png">

Amazon S3 관리형 키를 사용할 것인지, AWS KMS 키를 사용할 것인지가 나옵니다. KMS는 암호화 키로 객체를 보호하여 암호화되지 않은 상태로 방치되지 않도록 합니다. 또한 **KMS키에 대한 권한을 설정하고, 암호를 보호하는 데이터 키를 생성, 암호화 및 복호화하는 작업을 감사**할 수 있도록 합니다.

## 1.2. 고객 관리형 키
사용자가 직접 생성하는 KMS 키는 고객 관리형 키입니다. 사용자는 키 정책, IAM정책 및 권한 부여의 설정 및 유지 관리 등을 포함하여 KMS키에 대한 완전한 제어 권한을 가집니다.

예를 들자면 이런겁니다. 
```
집에 들어가기 위해서 우리는 열쇠를 사용해야 합니다(시간이 지나 우리는 도어락을 사용하지만요.). 
그러나 이전에 사용하던 주인이 여기의 문은 내가 가지고 있는 이 키로 열어야 한다고 줍니다. 
그러나 저는 우리 집만의 키는 남이 사용했던 키 말고, 내가 직접 제작해서 더 좋은 키로 바꾸고 싶거든요!
```

이처럼 KMS에 통합된 다양한 AWS 서비스 덕분에 사용자를 위해 저장 및 관리하는 데이터를 보호하도록 고객 관리형 키를 지정할 수 있습니다.

<img width="771" alt="스크린샷 2022-08-09 오후 11 58 47" src="https://user-images.githubusercontent.com/68142821/183684670-9a3878ea-0f3f-4317-b4b0-aacce6f0c50d.png">

만드는 것은 별로 어렵지 않습니다. 사용자가 원하는 선택지만 사용하면 되겠습니다.

## 1.3. 사용자 지정 키 스토어
사용자 지정 키 스토어는 AWS 클라우드에 하드웨어 보안 모듕을 제공하는 것입니다. 여기서는 CloudHSM의 서비스를 이용해야 하는데 HSM은 Hardware Security Module입니다. 즉, AWS KMS으로 관리하는 것이 아닌 하드웨어가 직접적으로 키를 관리하는 것을 의미합니다.

암호화키를 생성하고 제어하기 위한 관리형 서비스는 원하지만 자체 HSM은 원하지 않거나 운영할 필요가 없는 경우에는 위의 KMS 서비스들을 이용하면 됩니다.

사용자 지정 키 스토어는 사용자가 소유하고 관리하는 CloudHSM 클러스터에 의해 제작되기 때문에 KMS 내에서 제작할 수 없습니다.

<img width="1351" alt="스크린샷 2022-08-10 오전 12 12 37" src="https://user-images.githubusercontent.com/68142821/183688011-a4ba056d-adc1-42d1-84df-b2156c297b14.png">

